from flask import Flask, request, jsonify
from flask import render_template
from compute_feat import *
app = Flask(__name__)

@app.route('/')
def hello_world():
    return 'Hello World!'

@app.route('/hello')
def hello():
    return render_template('hello.html')

@app.route('/jump', methods=['POST'])
def jump():
    print request.form['password']
    print request.form['username']
    return request.form['username']

@app.route('/upload_wav', methods=['POST'])
def uplad_wav():
    print 'in upload'
    print request.files
    print request.form['start']
    print request.form['end']
    f = request.files['fileupload']
    f.save('wav/aaa.wav')
    feat_extract('wav/aaa.wav', 'conf', '../nnet')
    seglist = dvec_seg('wav/aaa.wav')
    print seglist
    #seglist = [[[0.21, 2.24], 0], [[2.24, 6.6], 1], [[6.6, 8.11], 0], [[8.11, 16.09], 1], [[16.09, 17.44], 0], [[17.44, 20.97], 1], [[20.97, 21.14], 0]]
    #seglist = [[[0.71, 1.99], 1], [[1.99, 3.36], 0], [[3.36, 3.71], 1], [[3.71, 5.34], 0], [[5.34, 6.05], 1], [[6.05, 6.36], 0], [[6.36, 6.62], 1], [[6.62, 7.19], 0], [[7.19, 7.58], 1], [[7.58, 8.59], 0], [[8.59, 10.46], 1], [[10.46, 10.98], 0], [[10.98, 12.93], 1], [[12.93, 14.46], 0], [[14.46, 14.91], 1], [[14.91, 15.3], 0], [[15.3, 15.43], 1], [[15.43, 15.74], 0], [[15.74, 16.55], 1], [[16.55, 18.84], 0], [[18.84, 19.07], 1], [[19.07, 19.42], 0], [[19.42, 19.9], 1], [[19.9, 21.01], 0], [[21.01, 21.17], 1], [[21.17, 23.35], 0], [[23.35, 26.03], 1], [[26.03, 26.62], 0], [[26.62, 26.87], 1], [[26.87, 27.69], 0], [[27.69, 28.08], 1], [[28.08, 28.39], 0], [[28.39, 29.48], 1], [[29.48, 29.83], 0], [[29.83, 31.81], 1], [[31.81, 34.48], 0], [[34.48, 36.34], 1], [[36.34, 36.52], 0], [[36.52, 38.49], 1], [[38.49, 39.5], 0], [[39.5, 41.39], 1], [[41.39, 41.63], 0], [[41.63, 43.56], 1], [[43.56, 43.67], 0], [[43.67, 44.02], 1], [[44.02, 44.47], 0], [[44.47, 44.91], 1], [[44.91, 45.95], 0], [[45.95, 47.39], 1], [[47.39, 49.22], 0], [[49.22, 50.17], 1], [[50.17, 51.01], 0], [[51.01, 52.3], 1], [[52.3, 52.79], 0], [[52.79, 53.08], 1], [[53.08, 53.42], 0], [[53.42, 55.46], 1], [[55.46, 55.83], 0], [[55.83, 56.22], 1], [[56.22, 56.53], 0], [[56.53, 58.47], 1], [[58.47, 59.37], 0], [[59.37, 60.19], 1], [[60.19, 60.42], 0], [[60.42, 60.94], 1], [[60.94, 61.26], 0], [[61.26, 61.71], 1], [[61.71, 62.63], 0], [[62.63, 62.69], 1], [[62.69, 64.09], 0], [[64.09, 64.85], 1], [[64.85, 65.58], 0], [[65.58, 65.94], 1], [[65.94, 66.31], 0], [[66.31, 67.0], 1], [[67.0, 67.68], 0], [[67.68, 68.13], 1], [[68.13, 69.89], 0], [[69.89, 70.16], 1], [[70.16, 70.7], 0], [[70.7, 71.09], 1], [[71.09, 72.55], 0], [[72.55, 73.86], 1]]
    #print "================="
    print seglist
    return jsonify(result=seglist)

@app.route('/_add_numbers')
def add_numbers():
    a = request.args.get('a', 0, type=int)
    b = request.args.get('b', 0, type=int)
    return jsonify(result=a + b)

if __name__ == '__main__':
    app.run(host='0.0.0.0', debug=True)

